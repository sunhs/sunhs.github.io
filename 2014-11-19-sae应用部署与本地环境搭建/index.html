<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>sae-Django-MySQL应用部署与本地环境搭建 | Sword and Poem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="第一次使用sae是搭建微信公众号用的，当时直接在sae的editor上写代码，那体验实在过瘾。第二次是课程作业需要用到服务器，所以在sae上面搭建，这回学乖了，搭建本地开发环境进行测试。但是由于缺乏经验，而且教程较为零碎，搭建过程耗时巨大。时隔数月，第三次需要用到本地环境，可是由于更换了电脑，把原来的搭建过程给忘了。于是痛下决心，把过程记录下来，也企盼着搜索教程的人能够找到我这个“心灵驿站”。">
<meta property="og:type" content="article">
<meta property="og:title" content="sae-Django-MySQL应用部署与本地环境搭建">
<meta property="og:url" content="http://sunhs.github.io/2014-11-19-sae应用部署与本地环境搭建/">
<meta property="og:site_name" content="Sword and Poem">
<meta property="og:description" content="第一次使用sae是搭建微信公众号用的，当时直接在sae的editor上写代码，那体验实在过瘾。第二次是课程作业需要用到服务器，所以在sae上面搭建，这回学乖了，搭建本地开发环境进行测试。但是由于缺乏经验，而且教程较为零碎，搭建过程耗时巨大。时隔数月，第三次需要用到本地环境，可是由于更换了电脑，把原来的搭建过程给忘了。于是痛下决心，把过程记录下来，也企盼着搜索教程的人能够找到我这个“心灵驿站”。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sae-Django-MySQL应用部署与本地环境搭建">
<meta name="twitter:description" content="第一次使用sae是搭建微信公众号用的，当时直接在sae的editor上写代码，那体验实在过瘾。第二次是课程作业需要用到服务器，所以在sae上面搭建，这回学乖了，搭建本地开发环境进行测试。但是由于缺乏经验，而且教程较为零碎，搭建过程耗时巨大。时隔数月，第三次需要用到本地环境，可是由于更换了电脑，把原来的搭建过程给忘了。于是痛下决心，把过程记录下来，也企盼着搜索教程的人能够找到我这个“心灵驿站”。">

  
    <link rel="alternative" href="/atom.xml" title="Sword and Poem" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Sword and Poem</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="sunhs.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-sae应用部署与本地环境搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014-11-19-sae应用部署与本地环境搭建/" class="article-date">
  <time datetime="2014-11-19T11:41:37.000Z" itemprop="datePublished">2014-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      sae-Django-MySQL应用部署与本地环境搭建
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>第一次使用sae是搭建微信公众号用的，当时直接在sae的editor上写代码，那体验实在过瘾。第二次是课程作业需要用到服务器，所以在sae上面搭建，这回学乖了，搭建本地开发环境进行测试。但是由于缺乏经验，而且教程较为零碎，搭建过程耗时巨大。时隔数月，第三次需要用到本地环境，可是由于更换了电脑，把原来的搭建过程给忘了。于是痛下决心，把过程记录下来，也企盼着搜索教程的人能够找到我这个“心灵驿站”。<br><a id="more"></a><br>正如题目所讲，这篇文章针对的是Django框架。首先你得在sae上面新建应用和开启MySQL数据库服务。sae名义上支持Django框架，但是坑爹得很，仅仅支持版本1.4（或者1.5）。而发展快速、用户众多的Django已经上了版本1.7。为着新特性慕名而来的开发者们，不仅被这个门槛限制住了。好在我们还是有解决方案的。<br><br>sae的代码托管在svn上面，服务器是svn.sinaapp.com，仓库名一般就是sae应用的名字。为了将代码clone到本地，需要svn的工具——一般在搜索引擎上被提及最多的要数tortoise svn。这里对于此工具的使用就不再赘述，网上教程一大把一大把。需要注意的一点是，在clone你的仓库时，会要求你输入用户名和密码，这里并不是你新浪微博的用户名和密码，而是你sae的安全邮箱和安全密码。<br><br>用tortoise把代码clone下来以后，一般是这样的：</p>
<p><pre><code>应用名</code></pre></p>
<ul>
<li>版本号<br>— index.wsgi<br>— config.yaml<br>在版本号的文件夹下，运行命令django-admin startproject [项目名]，假设项目名为myapp，则目录结构变成这样：<br><pre><code>应用名</code></pre></li>
<li>版本号<ul>
<li>index.wsgi</li>
<li>config.yaml</li>
<li>manage.py</li>
<li>myapp<ul>
<li>(各种Django生成的文件，包括myapp文件夹，settings.py等等)<br>现在我们把[版本号]下的myapp里面的文件全都移到[版本号]下面，并且添加文件夹site-packages，如此：<br><pre><code>应用名</code></pre></li>
</ul>
</li>
</ul>
</li>
<li>版本号<ul>
<li>index.wsgi</li>
<li>config.yaml</li>
<li>manage.py</li>
<li>site-packages</li>
<li>(各种Django生成的文件，包括myapp文件夹，settings.py等等)<br>这时，由于index.wsgi是作为网站的入口，我们需要把入口应用设置为myapp里面的Django应用。所以要修改index.wsgi为：<br><pre><code>import sae<br>import os<br>import sys</code></pre></li>
</ul>
</li>
</ul>
<p>root = os.path.dirname(<strong>file</strong>)<br>sys.path.insert(0, os.path.join(root, ‘site-packages’))</p>
<p>from myapp import wsgi</p>
<p>application = sae.create_wsgi_app(wsgi.application)<br>接着，我们把Python的Django文件夹（一般位于Python安装目录下的Library/site-packages里）拷贝到site-packages里。由于index.wsgi已经将这个路径添加到os.path里，所以Django已经可以被找到。<br><br>接着，打开index.wsgi，修改成如下：</p>
<p><pre><code>name: [应用名]<br>version: [版本号]</code></pre></p>
<p>libraries:</p>
<ul>
<li>name: “django”<br>version: “[Django版本号]”<br>这里又要注意，冒号后面是有空格的。另一方面，应用名不等同于项目名。项目名只是代表你的Django项目，应用名是你在sae上部署的应用的名称，它在目录结构上包含着Django项目。<br><br>至此，我们的应用已经可以支持Django框架的1.7版本（或者，不出意外，可以用此方法支持任意版本）。<br>接下来的部分，我们要使得应用能在本地启动，并且跟数据库交互。<br><br>首先为了使得应用被Django识别，我们要编辑myapp下的settings.py，在INSTALLED<em>APPS里添加一行<br><pre><code>‘myapp’,</code></pre><br>注意不能少了逗号。<br><br>然后我们需要安装python的sae库及mysql库，这些python接口在sae云端都具备了，但是本地我们需要自己安装。<br><pre><code>pip install sae-python-sae<br>pip install mysql-python</code></pre><br>接着是数据库配置，同样在settings.py中添加下列代码：<br><pre><code>if ‘SERVER_SOFTWARE’ in os.environ:<br>  DOMAIN = ‘[应用url，如<a href="http://mysite.sinaapp.com" target="_blank" rel="external">http://mysite.sinaapp.com</a>]’<br>  DB_HOST = ‘w.rdc.sae.sina.com.cn’<br>  DB_PORT = ‘3307’<br>  DB_USER = ‘[你的应用的ACCESSKEY]’<br>  DB_PASS = ‘[你的应用的SECRETKEY]’<br>  DB_DB = ‘app</code></pre></em>[应用名]‘<br>  UEDITOR_UPLOAD = {<pre><code>  <span class="string">'BACKEND'</span>:<span class="string">'DjangoUeditor.saebackend'</span>,
  <span class="string">'DOMAIN'</span>:<span class="string">'[应用名]'</span>,
</code></pre>  }<br>else:<br>  local_db = True<br>  DOMAIN = ‘<a href="http://localhost:8000" target="_blank" rel="external">http://localhost:8000</a>‘<br>  CACHES_BACKEND = ‘django.core.cache.backends.memcached.MemcachedCache’<br>  if local_db:<pre><code>  <span class="title">DB_HOST</span> = <span class="string">'localhost'</span>
  DB_PORT = <span class="string">'[你的本地数据库服务的端口]'</span>
  DB_USER = <span class="string">'[你的本地数据库服务的用户名]'</span>
  DB_PASS = <span class="string">'[你的本地数据库服务的密码]'</span>
  DB_DB = <span class="string">'[你的本地数据库服务的名称]'</span>
</code></pre>  else:<pre><code>  from sae._restful_mysql <span class="keyword">import</span> monkey
  monkey.patch()
<span class="constant">  DB_HOST</span> = 'w.rdc.sae.sina.com.cn'
<span class="constant">  DB_PORT</span> = '<span class="number">3307</span>'
<span class="constant">  DB_USER</span> = '[你的应用的ACCESSKEY]'
<span class="constant">  DB_PASS</span> = '[你的应用的SECRETKEY]'
<span class="constant">  DB_DB</span> = ‘app_[应用名]’
</code></pre></li>
</ul>
<p>DATABASES = {<br>    ‘default’: {<br>        ‘ENGINE’: ‘django.db.backends.mysql’,<br>        ‘NAME’: DB_DB,<br>        ‘USER’: DB_USER,<br>        ‘PASSWORD’: DB_PASS,<br>        ‘HOST’: DB_HOST,<br>        ‘PORT’: DB_PORT,<br>    }<br>}<br>这里关于mysql的一些知识就不赘述了。当时我自己关于mysql服务器，mysql数据库名称，mysql的python接口等等之类的东西也是一头雾水。但是与本次主题关系不大，请自行学习。<br><br>数据库配置的意思是这样的：首先，第一个if测试是否在sae的云端环境，是的话，直接使用它的mysql服务。否则的话，则是本地环境，即else语句。嵌套if的意思是，如果要使用本地数据库，则将数据库配置为本地数据库的参数；否则使用云端数据库。这里比较容易混淆，用下面伪代码解释一下：</p>
<p><pre><code>if 云端环境:<br>    使用云端数据库<br>else:</code></pre></p>
<pre><code><span class="preprocessor">#此时是本地环境</span>
<span class="keyword">if</span> 使用本地数据库:
    <span class="preprocessor">#...</span>
<span class="keyword">else</span> 使用云端数据库：
    <span class="preprocessor">#...<span class="title">&lt;/code&gt;</span><span class="title">&lt;/pre&gt;</span></span>
</code></pre><p>不过比较坑爹的是，假如你在本地环境运行时也想使用云端数据库的话，只能手动把local_db设为False，目前我还没发现好的办法。<br>此时我们的配置就都完成啦。<br>接着在应用目录下，使用命令</p>
<p><pre><code>dev_server.py</code></pre><br>就可以启动本地环境（有的系统需要自行在python的sae库里找到dev_server.py文件来启动），接着你在访问本地服务器时，你与数据库的交互就会反映到你决定使用的数据库中（假设你已经把Django的模型应用到数据库中）。<br>而如果在django的python shell里操作，则也是使用你选择的数据库。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://sunhs.github.io/2014-11-19-sae应用部署与本地环境搭建/" data-id="citpchepuqjpcm6y" class="article-share-link" data-share="baidu">分享到</a>
      

      
        <a href="http://sunhs.github.io/2014-11-19-sae应用部署与本地环境搭建/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sae/">sae</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/心得/">心得</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程/">编程</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2014-11-15-somewhere-only-we-know/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">somewhere only we know</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2014-11-19-sae应用部署与本地环境搭建/" data-title="sae-Django-MySQL应用部署与本地环境搭建" data-url="http://sunhs.github.io/2014-11-19-sae应用部署与本地环境搭建/"></div>
  </section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sae/">sae</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心得/">心得</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂感/">杂感</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程/">编程</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Edward Zhu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"hyesun"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"nocss.css"}};with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>